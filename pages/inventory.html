<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knights Auto - Inventory</title>
    <link rel="stylesheet" media="screen and (min-width: 120px)" type="text/css" href="../css/inventory.css">
</head>
<body>
    <ul class="nav">
        <li><button onclick="location.href='index.html'"><b>Home</b></button></li>
        <li><button onclick="location.href='account.html'"><b>Account</b></button></li>
        <li><button onclick="location.href='rental.html'"><b>Reservation</b></button></li>
        <li><button onclick="location.href='contact.html'"><b>Contact Us</b></button></li>
        <li><button onclick="location.href='about.html'"><b>About Us</b></button></li>
    </ul>
    <div class="container">
        <h1><b>Car Inventory</b></h1>

        <button class="filter-toggle" onclick="toggleFilterForm()">Filter Cars</button>

        <form class="filter-form" action="#" method="get" onsubmit="performSearch(); return false;">
            <label for="manufacturerFilter"><b>Filter by Manufacturer:</b></label>
            <input type="text" id="manufacturerFilter" name="manufacturerFilter" placeholder="Enter manufacturer">
            
            <label for="carNameFilter"><b>Search by Car Name:</b></label>
            <input type="text" id="carNameFilter" name="carNameFilter" placeholder="Enter car name">

            <label for="yearFilter"><b>Filter by Year:</b></label>
            <input type="number" id="yearFilter" name="yearFilter" placeholder="Enter year">

            <label for="typeFilter"><b>Filter by Vehicle Type:</b></label>
            <select id="typeFilter" name="typeFilter">
                <option value="">Select type</option>
                <option value="sedan">Sedan</option>
                <option value="suv">SUV</option>
                <option value="truck">Truck</option>
                <!-- Add more options if we need -->
            </select>

            <label for="colorFilter"><b>Filter by Color:</b></label>
            <input type="text" id="colorFilter" name="colorFilter" placeholder="Enter color">

            <label for="idFilter"><b>Filter by Vehicle ID:</b></label>
            <input type="text" id="idFilter" name="idFilter" placeholder="Enter vehicle ID">

            <button type="submit"><b>Search</b></button>
        </form>

        <div id="searchResults"></div>
    </div>

    <script>
        function toggleFilterForm() {
            var filterForm = document.querySelector('.filter-form');
            filterForm.style.display = (filterForm.style.display === 'none' || filterForm.style.display === '') ? 'block' : 'none';
        }
    
        async function performSearch() {
            var searchResultsContainer = document.getElementById('searchResults');
            searchResultsContainer.innerHTML = ''; // Clear previous search results
    
            var query = buildQuery(); // Build query parameters
    
            try {
                var response = await fetch('http://localhost:3000/vehicles' + query);
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
    
                var data = await response.json();
                displaySearchResults(data); // Display search results
            } catch (error) {
                console.error('Error fetching data:', error);
                searchResultsContainer.innerHTML = '<p>Error fetching data. Please try again later.</p>';
            }
        }
    
        function buildQuery() {
            var manufacturer = document.getElementById('manufacturerFilter').value;
            var carName = document.getElementById('carNameFilter').value;
            var year = document.getElementById('yearFilter').value;
            var type = document.getElementById('typeFilter').value;
            var color = document.getElementById('colorFilter').value;
            var id = document.getElementById('idFilter').value;
    
            var queryParams = [];
            if (manufacturer) queryParams.push('manufacturer=' + encodeURIComponent(manufacturer));
            if (carName) queryParams.push('carName=' + encodeURIComponent(carName));
            if (year) queryParams.push('year=' + encodeURIComponent(year));
            if (type) queryParams.push('type=' + encodeURIComponent(type));
            if (color) queryParams.push('color=' + encodeURIComponent(color));
            if (id) queryParams.push('id=' + encodeURIComponent(id));
    
            return queryParams.length > 0 ? '?' + queryParams.join('&') : '';
        }
    
        function displaySearchResults(data) {
            var searchResultsContainer = document.getElementById('searchResults');
            if (data.length === 0) {
                searchResultsContainer.innerHTML = '<p>No results found.</p>';
                return;
            }
    
            var html = '<h2>Search Results</h2><ul>';
            data.forEach(function(vehicle) {
                html += '<li>';
                html +=  vehicle.manufacturer + '<br>';
                html +=  vehicle.vehicleName + '<br>';
                html += '<b>Year:</b> ' + vehicle.year + '<br>';
                html += '<b>Color:</b> ' + vehicle.color + '<br>';
                html += '<b>Type:</b> ' + vehicle.type + '<br>';
                html += '</div>';
                html += '<hr>'; // Add horizontal line between cars
            });
            html += '</ul>';
    
            searchResultsContainer.innerHTML = html;
        }
    </script>    
</body>
</html>
